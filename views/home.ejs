<% include partials/header %>
<title>IHL</title>
</head>

<body class="min-h-screen flex-col">
    <% include partials/nav %>
    <main class="flex flex-1 min-h-screen">
        <!-- side bar -->
        <% include partials/sidebar %>

        <!-- main-content -->
        <div class="main-content flex w-full px-8 mb-8">

            <!-- main-content leftside -->
            <div >
                <h2 class="text-grey-dark my-8">Profile</h2>
                <div class="card-container flex flex-col">
                    <div class="flex">
                        <div class="user card w-3/5">
                            <div class="flex justify-center w-1/2">
                                <img class="rounded-full" src="<%= profileimg %>" alt="">
                            </div>
                            <div class="px-4">
                                <h4 class="text-grey-darker capitalize"><%= name %></h4>
                                <p><small class="text-grey-dark">Latest badge won name</small></p>
                                <p class="mt-1 text-grey-darker">Lorem, ipsum dolor sit amet consectetur adipisicing elit</p>
                            </div>
                        </div>
                        <div class="device card ml-8 flex-col flex-1">
                            <h4 class="text-grey-darker">Device</h4>
                            <!-- <div class="addDevice mt-2 flex flex-col justify-center">
                                <p class="text-grey-dark text-sm">No device Connected</p>
                                <div class="flex justify-end mt-2">
                                    <a href="" class="bg-blue px-2 py-1 text-white rounded">Add Device</a>
                                </div>
                            </div> -->
                            <div class="device flex w-1/2">
                                <img src="/images/device.png" alt="" class="w-1/2">
                                <p class="text-blue ml-4" id = "deviceName"></p>
                            </div>
                        </div>
                    </div>
                    <div class="flex my-8 justify-between">
                        <div class="card w-1/3 flex flex-col justify-center items-center">
                            <h4 class="text-grey-dark">Today activity</h4>
                            <canvas id="recentActivity">
                            </canvas>
                            <div class="flex mt-2">
                                <div>
                                    <div class="running w-8 mx-2 h-1"></div>
                                    <p class="text-xss text-center mt-1 text-grey-darker">running</p>
                                </div>
                                <div>
                                    <div class="walking w-8 mx-2 h-1"></div>
                                    <p class="text-xss text-center mt-1 text-grey-darker">walking</p>
                                </div>
                                <div>
                                    <div class="sleeping w-8 mx-2 h-1"></div>
                                    <p class="text-xss text-center mt-1 text-grey-darker">sleeping</p>
                                </div>
                                <div>
                                    <div class="cardio w-8 mx-2 h-1"></div>
                                    <p class="text-xss text-center mt-1 text-grey-darker">cardio</p>
                                </div>
                            </div>
                        </div>
                        <div class="card flex flex-col w-1/3 mx-4">
                            <h4 class="text-grey-dark">Steps</h4>
                            <canvas id="stepsCanvas" class="max-w-16">
                            </canvas>
                            <div class="flex flex-col items-center">
                                <p class="text-xs text-center mb-1 text-grey-darker" id = "steps"></p>
                                <div class="walking w-8 mx-2 h-1"></div>
                                    <p class="text-xss text-center mt-1 text-grey-darker">70% more to go</p>
                            </div>
                        </div>
                        <div class="card flex flex-col w-1/3 ">
                            <h4 class="text-grey-dark">pulse</h4>
                            <div class="flex justify-between mt-8">
                                <p>78bpm</p>
                                <span class="text-green">normal</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex my-8 justify-between">
                        <div class="calories flex-col card w-1/3">
                            <h4 class="text-grey-dark">Calories</h4>
                            <div class="mt-8">
                                <div class="calories-chart">
                                    <canvas id="caloriesChart"></canvas>
                                </div>
                                <div class="flex mt-2 justify-center">
                                    <div>
                                        <div class="running w-8 mx-2 h-1"></div>
                                        <p class="text-xss text-center mt-1 text-grey-darker">Calories burnt</p>
                                    </div>
                                    <div>
                                        <div class="walking w-8 mx-2 h-1"></div>
                                        <p class="text-xss text-center mt-1 text-grey-darker">Goal</p>
                                    </div>
                                </div>
                                <div class="flex flex-col items-center">
                                    <p class="text-xs text-center mb-1 text-grey-darker" id = "calories"></p>
                                    <p class="text-xss text-center mt-1 text-grey-darker">20 Kcal more to loose  </p>
                                </div>
                            </div>
                        </div>
                        <div class="sleep flex flex-col card w-2/3 ml-4">
                            <h4 class="text-grey-dark mb-4">Sleep Activity</h4>
                            <canvas id="sleepCanvas" ></canvas>
                            <div class="flex flex-col items-center">
                                <div class="running w-8 mx-2 h-1"></div>
                                <p class="text-xs text-center mt-1 text-grey-darker">Sleep Log</p>
                            </div>
                        </div>
                    </div>
                    <div class="flex flex-col mt-2">
                        <div class="card flex flex-col items-center">
                            <h3 class="text-grey-dark mb-4">pastActivity</h3>
                            <div class="flex w-full justify-end">
                                <div class="flex flex-col justify-center mr-4">
                                    <div class="w-8 mx-2 h-1"></div>
                                    <p class="text-sm text-center mt-1 text-grey-darker" onclick="updatePastData(myChart, 'calories')">Calories</p>
                                </div>
                                <div class="flex flex-col justify-center mr-4">
                                    <div class="w-8 mx-2 h-1"></div>
                                    <p class="text-sm text-center mt-1 text-grey-darker" onclick="updatePastData(myChart, 'steps')">Steps</p>
                                </div>
                                <div class="flex flex-col justify-center">
                                    <div class="w-8 mx-2 h-1"></div>
                                    <p class="text-sm text-center mt-1 text-grey-darker" onclick="updatePastData(myChart, 'distance')">Distance</p>
                                </div>
                            </div>
                            <canvas id="pastActivity" class="h-64 max-w-md" width="400">
                            </canvas>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>
    <% include partials/footer %>
</body>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/pastActivity.js"></script>
    <script src="/js/dailyactivity.js"></script>
    <script>
        var pastStepsData, pastCaloriesData, pastDistanceData

        function updateData(chart, label, data) {
            if(label.length > 0)
                chart.data.datasets[0].label = label
            chart.data.datasets[0].data = data
            chart.update();
        }

        function updateRecentActivity(chart, activities){
            chart.data.labels = []
            chart.data.datasets[0].data = []
            activities.forEach(activity => {
                chart.data.labels.push(activity.name)
                chart.data.datasets[0].data.push(activity.duration / (1000 * 60 * 60))
            });
            chart.update()
        }

        function updateSleep(chart, activities){
            chart.data.labels = []
            chart.data.datasets[0].data = []
            activities.forEach(activity => {
                chart.data.labels.push(activity.dateOfSleep)
                chart.data.datasets[0].data.push(activity.duration/(1000 * 60 * 60))
            });
            chart.update()
        }

        function updatePastData(chart, type){
            var data
            if(type == 'calories'){
                data = pastCaloriesData
            }else if(type == 'steps'){
                data = pastStepsData
            }else if(type == 'distance'){
                data = pastDistanceData
            }

            chart.data.labels = []
            chart.data.datasets[0].data = []
            chart.data.datasets[0].label = type
            data.forEach(ele => {
                chart.data.labels.push(ele.dateTime)
                chart.data.datasets[0].data.push(ele.value)
            });
            chart.update()
        }

        var socket = io();
        socket.on('fastData', function(data){
            console.log(data);
            $('#steps').text(data.steps)

            stepsData = []
            stepsData.push(data.steps)
            stepsData.push(data.goalSteps)
            updateData(stepsGraph, [], stepsData)

            calorieData = []
            calorieData.push(data.calories)
            calorieData.push(data.goalCalories)
            updateData(calorieGraph, [], calorieData)
        });
        socket.on('slowData', function(data){
            console.log(data);
            $('#deviceName').text(data.deviceName)
            $('#weight').text(data.weight)

            updateRecentActivity(recentChart, data['recentActivities'])
            updateSleep(sleepGraph, data['sleep'])
            // updatePastActivity(myChart, data['pastCalories'], data['pastSteps'], data['pastDistance']])
            pastCaloriesData = data['pastCalories']
            pastStepsData = data['pastSteps']
            pastDistanceData = data['pastDistance']
            updatePastData(myChart, 'calories')
        });
        socket.on('data', function(data){
            console.log(data);
        });

        socket.emit('getFastData');
        socket.emit('getSlowData');
        setInterval(function(){
            socket.emit('getFastData');
        }, 1000 * 30)
        setInterval(function(){
            socket.emit('getSlowData');
        }, 1000 * 60 * 10)


        // console.log('<%- JSON.stringify(kiosk_data) %>')
    </script>
</html>
